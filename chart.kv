#:kivy 1.11.1
#:import datetime datetime

<BalanceChart>:
    display:display
    dashboard:dashboard

    BoxLayout:
        pos:self.parent.pos
        size:self.parent.size
        orientation:'vertical'
        padding:50
        spacing:10

        Display:
            id:display
            size_hint:1, 0.8

        Dashboard:
            id:dashboard
            size_hint:1, 0.2


<Dashboard@FloatLayout>:
    date_range:date_range
    category_selector:category_selector
    period_selector:period_selector

    DateRange:
        id:date_range
        pos_hint:{'x':0.05, 'y':0.5}
        size_hint:0.4, 0.5

    PeriodSelector:
        id:period_selector
        pos_hint:{'x':0.5, 'y':0.5}
        size_hint:0.5, 0.5

    CategorySelector:
        id:category_selector
        pos_hint:{'x':0, 'y':0}
        size_hint:1, 0.5


<DateRange>:
    begin:begin
    end:end
    orientation:'horizontal'

    DateSelector:
        id:begin

    Label:
        size_hint:0.1, 1
        text:'-'

    DateSelector:
        id:end


<DateSelector>:
    id:date_selector
    year_spinner:year_spinner
    month_spinner:month_spinner
    day_spinner:day_spinner

    BoxLayout:
        pos:self.parent.pos
        size:self.parent.size
        orientation:'horizontal'
        padding:20

        Spinner:
            id:year_spinner
            text:str(datetime.date.today().year)
            values:tuple(str(i) for i in range(min(entry.date.year for entry in app.book), max(entry.date.year for entry in app.book) + 1))
            on_text:date_selector.update_year()

        Spinner:
            id:month_spinner
            text:str(datetime.date.today().month)
            values:tuple(str(i) for i in range(1, 13))
            on_text:date_selector.update_month()

        Spinner:
            id:day_spinner
            text:str(datetime.date.today().day)
            values:tuple(str(i) for i in range(1, 32))
            on_text:date_selector.update_day()


<CategorySelector>:
    income:income
    outgo:outgo
    balance:balance
    orientation:'horizontal'
    padding:20
    spacing:20

    CategoryToggle:
        id:income
        text:'income'

    CategoryToggle:
        id:outgo
        text:'outgo'

    CategoryToggle:
        id:balance
        text:'balance'


<PeriodSelector>:
    day:day
    week:week
    month:month
    year:year
    orientation:'horizontal'
    padding:20
    spacing:20

    PeriodToggle:
        id:day
        text:'day'

    PeriodToggle:
        id:week
        text:'week'

    PeriodToggle:
        id:month
        text:'month'

    PeriodToggle:
        id:year
        text:'year'


<Bar>:
    canvas:
        Color:
            rgba:(1, 0, 0, 0.75)
        Rectangle:
            pos:[self.x + self.width * 0.4, self.y + self.height * self.origin]
            size:(self.width * 0.2, self.height * self.value)
    Label:
        pos:[self.parent.x + self.parent.width * 0.4, self.parent.y + self.parent.height * (self.parent.origin + self.parent.value) - (self.parent.value < 0) * self.height]
        size:self.parent.width * 0.2, self.texture_size[1]
        text:str(self.parent.amount)
        halign:'center'


<BreakdownContent>:
    table:table
    close_button:close_button
    prev_button:prev_button
    next_button:next_button

    ScrollView:
        pos_hint:{'x':0.1, 'y':0.2}
        size_hint:(0.8, 0.8)

        GridLayout:
            id:table
            cols:2
            height:self.minimum_height
            size_hint_y:None
            row_default_height:50

    Button:
        id:close_button
        pos_hint:{'x':0.1, 'y':0}
        size_hint:(0.8, 0.15)
        text:'close'

    Button:
        id:prev_button
        pos_hint:{'x':0.025, 'y':0.25}
        size_hint:(0.05, 0.5)
        text:'<'
        bold:True

    Button:
        id:next_button
        pos_hint:{'x':0.925, 'y':0.25}
        size_hint:(0.05, 0.5)
        text:'>'
        bold:True


<BreakdownEntry>:
    text_size:self.size
    canvas:
        Color:
            rgba:self.background_color
        Rectangle:
            pos:self.pos
            size:self.size


<Display>:
    x_axis:x_axis
    y_axis:y_axis
    plot_area:plot_area
    view:view

    YAxis:
        id:y_axis
        pos_hint:{'x':0, 'y':0.1}
        size_hint:0.1, 0.9

    ScrollView:
        pos_hint:{'x':0.1, 'y':0}
        size_hint:0.9, 1

        FloatLayout:
            id:view
            pos:self.parent.pos
            size:self.parent.size
            size_hint_x:None

            XAxis:
                id:x_axis
                rows:1
                col_default_width:200
                pos_hint:{'x':0, 'y':0}
                size_hint:1, 0.1

            PlotArea:
                id:plot_area
                rows:1
                col_default_width:200
                pos_hint:{'x':0, 'y':0.1}
                size_hint:1, 0.9
